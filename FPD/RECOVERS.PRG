*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        08/17/97            RECOVERS.PRG               12:18:03 
*                                                                
*       픔컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        Author's Name                                           
*                                                                
*        Copyright (c) 1997 Company Name                         
*        Address                                                 
*        City,     Zip                                           
*                                                                
*        Description:                                            
*        This program was automatically generated by GENSCRN.    
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                       MS-DOS Window definitions                
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

IF NOT WEXIST("recovers") ;
	OR UPPER(WTITLE("RECOVERS")) == "RECOVERS.PJX" ;
	OR UPPER(WTITLE("RECOVERS")) == "RECOVERS.SCX" ;
	OR UPPER(WTITLE("RECOVERS")) == "RECOVERS.MNX" ;
	OR UPPER(WTITLE("RECOVERS")) == "RECOVERS.PRG" ;
	OR UPPER(WTITLE("RECOVERS")) == "RECOVERS.FRX" ;
	OR UPPER(WTITLE("RECOVERS")) == "RECOVERS.QPR"
	DEFINE WINDOW recovers ;
		FROM INT((SROW()-17)/2),INT((SCOL()-74)/2) ;
		TO INT((SROW()-17)/2)+16,INT((SCOL()-74)/2)+73 ;
		TITLE " Recover V2.0 for FoxPro/DOS 2.6 " ;
		NOFLOAT ;
		NOCLOSE ;
		NOMINIMIZE ;
		DOUBLE ;
		COLOR SCHEME 1
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                RECOVERS/MS-DOS Setup Code - SECTION 2          
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
PRIVATE ALL
TempSS = ' '
FPTfile = ''
OptCodes = ''
GenDefOpts = ''
Dext='DEF'
TempNo = 0
DbfName = 'Not selected'
MemName = ''
HelpPath = IIF(FILE('MANUAL.TXT'), FULLPATH('MANUAL.TXT'),'')
RepPath = IIF(FILE('Recover.rep'), FULLPATH('Recover.rep'),'')

Default0 = Fullpath('.')
FilePath = '' && path of file to repair

DIMENSION OptCode[21]
FOR i = 1 TO 21
  OptCode[i] = .T.
ENDFOR
OptCode[3] = .F. && do not check field in record scan
OptCode[4] = .F. && do not use warnings in field check

Dimension GenOpt[6]
GenOpt = .F.
GenOpt[4] = .T. && use dialogs


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                     RECOVERS/MS-DOS Screen Layout              
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
IF WVISIBLE("recovers")
	ACTIVATE WINDOW recovers SAME
ELSE
	ACTIVATE WINDOW recovers NOSHOW
ENDIF
@ 12,21 TO 14,50
@ 2,0 SAY "RecordFile:" ;
	SIZE 1,11, 0
@ 2,12 SAY Dbfname ;
	SIZE 1,60 ;
	PICTURE "@T"
@ 0,18 SAY "Copyright (C) 1995, Abri Technologies" ;
	SIZE 1,37, 0
@ 1,27 SAY "Single user license" ;
	SIZE 1,19, 0 ;
	COLOR G+/B    
@ 4,5 GET RecSels ;
	PICTURE "@*HN Select record file;ErrorScan / Repair;View File" ;
	SIZE 1,20,1 ;
	DEFAULT 1 ;
	VALID RECSELSV()
@ 6,5 GET RecSels2 ;
	PICTURE "@*HN View Repair Report;Generate .DEF file;View manual.txt" ;
	SIZE 1,20,1 ;
	DEFAULT 1 ;
	VALID RECSELS2V()
@ 13,23 GET Ropts ;
	PICTURE "@*HN OPTIONS;E X I T" ;
	SIZE 1,11,4 ;
	DEFAULT 1 ;
	VALID ROPTSV()
@ 8,23 SAY "Requires good DBF/FPT copy." ;
	SIZE 1,27, 0 ;
	COLOR W/B     
@ 9,23 SAY "But you can attempt it from" ;
	SIZE 1,27, 0 ;
	COLOR W/B     
@ 10,23 SAY "bad file with GenDef option." ;
	SIZE 1,28, 0 ;
	COLOR W/B     
@ 7,26 SAY "/" ;
	SIZE 1,1, 0 ;
	COLOR W/B     
@ 7,45 SAY "\" ;
	SIZE 1,1, 0 ;
	COLOR W/B     

IF NOT WVISIBLE("recovers")
	ACTIVATE WINDOW recovers
ENDIF

READ CYCLE MODAL ;
	SHOW _rn80qd5ec()

RELEASE WINDOW recovers

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                     RECOVERS/MS-DOS Cleanup Code               
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
SET DEFAULT TO (Default0)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        RECSELSV           RecSels VALID                        
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         RECOVERS,     Record Number:    7  
*        Variable:            RecSels                            
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      1                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION RECSELSV     &&  RecSels VALID
#REGION 1
DO CASE
CASE RecSels = 1 && select new DbfFile
  dbfname = GETFILE('DBF', 'Select .DBF:','Select',0)
  IF NOT EMPTY(DbfName)
    FilePath = LEFT(FULLPATH(dbfname),RAT('\',FULLPATH(dbfname)))
    SET DEFAULT TO (FilePath)
    IF ATC('.DBF', DBFname)=0
      MemName=GETFILE('*', 'SELECT (if) MEMOFILE?')
    ENDIF
  ELSE
    DbfName = 'Not selected'
  ENDIF
  SHOW GETS
CASE RecSels = 2 && Fix file
  =illegal(DbfName, MemName, OptCodes, DEXT)
CASE RecSels = 3 && ViewFile
  =BrowsFil(DbfName)
ENDCASE


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        RECSELS2V           RecSels2 VALID                      
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         RECOVERS,     Record Number:    8  
*        Variable:            RecSels2                           
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      2                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION RECSELS2V     &&  RecSels2 VALID
#REGION 1
DO CASE
CASE RecSels2 = 1 && View RECOVREP.TXT file
  RepPath = FULLPATH('RECOVREP.TXT')
  IF !EMPTY(RepPath)
    MODIFY FILE (RepPath) NOEDIT
  ENDIF
CASE RecSels2 = 2 && Generate .DEF file
  IF !FILE(DBFname) && bad .dbf name required
    =rMsgBox("Select target .DBF file first!",  "Notice:", 0)
    RETURN
  ENDIF
  PRIVATE GoodFile, GoodMemName, DBFleft, DefFile, GoodLeft, ErrorCode
  * Get good file loc and gen and copy next to bad file
  IF USED(DBFname)
    USE IN (DBFname)
  ENDIF
  SELECT 0
  ErrorCode = 0
  ON ERROR ErrorCode = ERROR() && does this act ok in VFP???
  USE (DBFname)
  ON ERROR *
  USE
  ON ERROR
  IF ErrorCode > 0 AND !GenOpt[5]
    GoodFile = GETFILE('DBF', 'Select good .DBF file:','Select',0)
  ELSE
    GoodFile = DBFName
  ENDIF
  IF EMPTY(GoodFile)
    RETURN
  ENDIF
  GoodMemName = ''
  IF ATC('.DBF', GoodFile)=0 AND DBFname != GoodFile
    GoodMemName=GETFILE('*', 'SELECT good MemoFile:')
  ELSE
    GoodMemName=MemName
  ENDIF
  =GenDef(GoodFile, GoodMemName, GenDefOpts, Dext)
  DBFleft = UPPER(IIF(RAT('.',DBFname)>0, LEFT(DBFname, RAT('.',DBFname)-1), DBFname))
  DefFile = DBFleft+'.'+DExt && field definition file
  GoodLeft = UPPER(IIF(RAT('.', GoodFile)>0, LEFT(GoodFile, RAT('.',GoodFile)-1), GoodFile))
  IF FILE(DefFile) AND FULLPATH(GoodFile) != FULLPATH(DBFname) && dbf may be ok
    ERASE (DefFile)
    COPY FILE (GoodLeft + '.' + DExt) TO (DefFile)
  ENDIF
CASE RecSels2 = 3 && Help/Instr.
  HelpPath = IIF(Empty(HelpPath), getfile('TXT', "Where is MANUAL.TXT?"), HelpPath)

	DEFINE WINDOW _Brow11 ;
		FROM INT((SROW()-25)/2),INT((SCOL()-80)/2) ;
		TO INT((SROW()-25)/2)+24,INT((SCOL()-80)/2)+79 ;
		TITLE " Use windows cursor controls - ^F to search, ESC to exit! " ;
		NOFLOAT ;
		NOCLOSE ;
		NOMINIMIZE ;
		DOUBLE ;
		COLOR SCHEME 1


  IF !EMPTY(HelpPath)
    MODIFY FILE (HelpPath) NOEDIT window _brow11
  ENDIF
  release window _brow11
ENDCASE


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        ROPTSV           Ropts VALID                            
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         RECOVERS,     Record Number:    9  
*        Variable:            Ropts                              
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      3                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION ROPTSV     &&  Ropts VALID
#REGION 1
IF Ropts = 1
  DO recopts.spr
ELSE
  CLEAR READ
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RN80QD5EC           Read Level Show                    
*                                                                
*        Function Origin:                                        
*                                                                
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         RECOVERS                           
*        Called By:           READ Statement                     
*        Snippet Number:      4                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rn80qd5ec     && Read Level Show
PRIVATE currwind
STORE WOUTPUT() TO currwind
*
* Show Code from screen: RECOVERS
*
#REGION 1
IF SYS(2016) = "RECOVERS" OR SYS(2016) = "*"
	ACTIVATE WINDOW recovers SAME
	@ 2,12 SAY Dbfname ;
		SIZE 1,60, 0 ;
		PICTURE "@T"
ENDIF
IF NOT EMPTY(currwind)
	ACTIVATE WINDOW (currwind) SAME
ENDIF